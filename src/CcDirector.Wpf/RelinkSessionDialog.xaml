<Window x:Class="CcDirector.Wpf.RelinkSessionDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Re-link Claude Session"
        Width="700" Height="500"
        MinWidth="500" MinHeight="400"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResizeWithGrip"
        Background="#252526">

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,12">
            <TextBlock Text="Select the correct Claude session to link:"
                       Foreground="#CCCCCC" FontSize="14" />
            <TextBlock x:Name="RepoPathText" Text=""
                       Foreground="#888888" FontSize="11" Margin="0,4,0,0" />
        </StackPanel>

        <!-- Search box -->
        <TextBox x:Name="SearchBox" Grid.Row="1"
                 Background="#1E1E1E" Foreground="#CCCCCC"
                 BorderBrush="#3C3C3C" Padding="8"
                 TextChanged="SearchBox_TextChanged"
                 ToolTip="Filter sessions by summary or first prompt" />

        <!-- Session list -->
        <Grid Grid.Row="2" Margin="0,8,0,0">
            <!-- Loading indicator -->
            <TextBlock x:Name="LoadingText" Text="Loading sessions..."
                       Foreground="#888888" FontStyle="Italic"
                       HorizontalAlignment="Center" VerticalAlignment="Center" />

            <!-- No sessions message -->
            <TextBlock x:Name="NoSessionsText" Text="No Claude sessions found for this repository"
                       Foreground="#888888" FontStyle="Italic"
                       HorizontalAlignment="Center" VerticalAlignment="Center"
                       Visibility="Collapsed" />

            <!-- Session list -->
            <ListBox x:Name="SessionList"
                     Background="#1E1E1E" Foreground="#CCCCCC"
                     BorderBrush="#3C3C3C"
                     Visibility="Collapsed"
                     SelectionChanged="SessionList_SelectionChanged">
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <Grid Margin="4,6">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <!-- Row 0: Session ID + message count -->
                            <StackPanel Grid.Row="0" Grid.Column="0" Orientation="Horizontal">
                                <TextBlock Text="{Binding SessionIdShort}"
                                           FontFamily="Consolas, Courier New"
                                           FontSize="12" Foreground="#9CA3AF" />
                                <Border Background="#3B82F6" CornerRadius="4" Padding="4,1" Margin="8,0,0,0">
                                    <TextBlock Text="{Binding MessageCountDisplay}"
                                               Foreground="White" FontSize="10" />
                                </Border>
                            </StackPanel>

                            <!-- Time ago -->
                            <TextBlock Grid.Row="0" Grid.Column="1"
                                       Text="{Binding TimeAgo}"
                                       Foreground="#888888" FontSize="11" />

                            <!-- Row 1: Summary -->
                            <TextBlock Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2"
                                       Text="{Binding DisplaySummary}"
                                       Foreground="#22C55E" FontSize="11"
                                       TextTrimming="CharacterEllipsis" Margin="0,4,0,0" />

                            <!-- Row 2: First prompt snippet -->
                            <TextBlock Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2"
                                       Text="{Binding FirstPromptDisplay}"
                                       Foreground="#6B7280" FontSize="10"
                                       TextTrimming="CharacterEllipsis" Margin="0,2,0,0">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Visibility" Value="Visible" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding FirstPromptDisplay}" Value="">
                                                <Setter Property="Visibility" Value="Collapsed" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </Grid>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
        </Grid>

        <!-- Bottom buttons -->
        <StackPanel Grid.Row="3" Orientation="Horizontal"
                    HorizontalAlignment="Right" Margin="0,12,0,0">
            <Button x:Name="BtnLink" Content="Link Selected" Width="120"
                    Click="BtnLink_Click"
                    Background="#22C55E" Foreground="White"
                    BorderThickness="0" Margin="0,0,8,0"
                    Cursor="Hand" IsEnabled="False" />
            <Button Content="Cancel" Width="80"
                    Click="BtnCancel_Click"
                    Background="#3C3C3C" Foreground="#CCCCCC"
                    BorderThickness="0" Cursor="Hand" />
        </StackPanel>
    </Grid>
</Window>
